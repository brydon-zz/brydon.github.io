<?php
if (isset($_POST['username'])) {
	start_session();
	$db = new PDO("mysql:dbname=CSC241E;host=localhost", "csc241e", "sdwk2384");
	$a = $db->query("SELECT * FROM users");
	foreach($a as $u) echo $u['name'];
	$userName = $db->quote($_POST['username']);
	$password = $db->quote($_POST['password']);
	$email = $db->quote($_POST['email'])
	$db->query("INSERT INTO users (name,password,email) VALUES($userName,$password,$email)");
} else {
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--// W3C Recommended the above doctype //-->
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Sign Up</title>
		<script type="application/javascript">
			function createObject() {
				var request_type;
				var browser = navigator.appName;
				if (browser == "Microsoft Internet Explorer"){ // BOOO
					request_type = new ActiveXObject("Microsoft.XMLHTTP");
				} else{
					request_type = new XMLHttpRequest();
				}
					return request_type;
			}

			var http = createObject();
			var uname;
			var pwd1;
			var pwd2;
			var email;
			var unameOut;
			var emailOut;
			var pwd1Out;
			var pwd2Out;
			var button;
			var regex = /^[a-zA-Z][a-zA-Z0-9\.\-_]*[a-zA-Z]@[a-zA-Z][\.a-zA-Z0-9]*[a-zA-Z]\.[a-z]{2,4}$/;
			var regex2 = /^[a-zA-Z0-9]+$/;
			function formChecker() {
				if (pwd1.value.length < 6) pwd1Out.innerHTML = "Make your password longer!";
				else pwd1Out.innerHTML = "";
				if (pwd1.value.length > 6 && pwd1.value != pwd2.value) pwd2Out.innerHTML = "Make 'em match, yo.";
				else pwd2Out.innerHTML = "";
				if (!regex.test(email.value))	emailOut.innerHTML = "Enter a real email, dawg.";
				else emailOut.innerHTML = "";
				if (pwd1Out.innerHTML == "" && pwd2Out.innerHTML == "" && emailOut.innerHTML == "" && unameOut.innerHTML == "" && uname.value != "") button.disabled = false;
				else button.disabled = true;
				if(!regex2.test(uname.value)) unameOut.innerHTML = "Must be letters or numbers only.";
			};	

			function checkUname() {
				http.open('get', 'checkUserName.php?username='+uname.value ,true);
				http.onreadystatechange = function() {unameOut.innerHTML = http.responseText;};
				http.send(null);
			};

			window.onload=function() {
				button = document.getElementById('submit');
				button.disabled = true;
				uname = document.getElementById('username');
				email = document.getElementById('email');
				pwd1 = document.getElementById('password1');
				pwd2 = document.getElementById('password2');
				unameOut = document.getElementById('usernameout');
				emailOut = document.getElementById('emailout');
				pwd1Out = document.getElementById('passwordout');
				pwd2Out = document.getElementById('password2out');
				uname.onchange = checkUname;
			}
			setInterval(formChecker,100);
		</script>
	</head>
	<body>
		
		<div>
			<form id="signupForm" method="POST" action="signup.php">
                            <div style="width:150px;float:left;">
Username:<br /> 
Password:<br />Re-Enter Password:<br />Email Address
                            </div>
                            <div style="width:500px;float:left;">
				<input name="username" id="username" type="text"><span id="usernameout"></span><br>
				<input name="password" id="password1" type="password"><span id="passwordout">Make your password longer!</span><br>
				<input name="password2" id="password2" type="password"><span id="password2out"></span><br>
				<input name="email" id="email" type="text"><span id="emailout">Enter a real email, dawg.</span><br>
				<input disabled="" id="submit" value="Submit" type="submit" style="margin-left:161px">
                            </div>
			</form>
		</div>
	</body>
</html><?}?>
